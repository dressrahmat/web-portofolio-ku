import{b as ee,r as s,a as te,c as x,j as e,L as B,H as se}from"./app-D8V9dMlB.js";import{A as re}from"./AdminLayout-Beol0sNM.js";import{C as ae,B as le,D as ne,P as oe,F as ce}from"./Pagination-k11g6GpM.js";import{C as R}from"./ConfirmationModal-DylGxcjJ.js";import{P as F}from"./PrimaryButton-MOgviXTC.js";import{e as T,f as ie,O as L,q as de,i as ue,v as me,d as he,j as xe}from"./index-CIlKK3-v.js";import{r as pe}from"./index-v3s1ulWH.js";import"./Checkbox-BOT6ep68.js";const fe=({trigger:r,children:n,position:u="bottom-right"})=>{const[i,m]=s.useState({top:0,left:0,width:0}),d=s.useRef(null),[p,f]=s.useState(!1),N=()=>{if(d.current){const o=d.current.getBoundingClientRect();m({top:o.bottom+window.scrollY,left:o.left+window.scrollX,width:o.width})}},l=()=>{switch(u){case"bottom-left":return"origin-top-left left-0";case"bottom-right":return"origin-top-right right-0";default:return"origin-top-right right-0"}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:d,onClick:()=>{N(),f(!0)},children:r}),p&&pe.createPortal(e.jsx("div",{className:"fixed inset-0 z-50",onClick:()=>f(!1),children:e.jsx("div",{className:`absolute mt-1 w-48 rounded-md shadow-lg bg-neutral-50 dark:bg-neutral-800 ring-1 ring-primary-500 ring-opacity-20 focus:outline-none ${l()}`,style:{top:i.top,left:u==="bottom-right"?"auto":i.left,right:u==="bottom-right"?window.innerWidth-i.left-i.width:"auto",zIndex:9999},onClick:o=>o.stopPropagation(),children:n})}),document.body)]})},ge=({user:r,onView:n,onEdit:u,onDelete:i,hasEditPermission:m,hasDeletePermission:d})=>{const p=e.jsx("button",{className:"inline-flex justify-center w-full p-2 text-sm font-medium text-primary-600 dark:text-primary-400 bg-neutral-50 dark:bg-neutral-800 rounded-md hover:bg-primary-50 dark:hover:bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:e.jsx(xe,{className:"h-4 w-4","aria-hidden":"true"})});return e.jsx(fe,{trigger:p,position:"bottom-right",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:n,className:"group flex items-center w-full px-4 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-primary-50 dark:hover:bg-neutral-700 hover:text-primary-600 dark:hover:text-primary-400",children:[e.jsx(ue,{className:"mr-3 h-4 w-4","aria-hidden":"true"}),"View"]}),m&&e.jsxs("button",{onClick:u,className:"group flex items-center w-full px-4 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-primary-50 dark:hover:bg-neutral-700 hover:text-primary-600 dark:hover:text-primary-400",children:[e.jsx(me,{className:"mr-3 h-4 w-4","aria-hidden":"true"}),"Edit"]}),d&&e.jsxs("button",{onClick:i,className:"group flex items-center w-full px-4 py-2 text-sm text-error-600 dark:text-error-400 hover:bg-error-50 dark:hover:bg-error-900/30 hover:text-error-700 dark:hover:text-error-300",children:[e.jsx(he,{className:"mr-3 h-4 w-4","aria-hidden":"true"}),"Delete"]})]})})},be=(r=[])=>{const[n,u]=s.useState(()=>{try{const m=sessionStorage.getItem("selectedUsers");return m?JSON.parse(m):r}catch{return r}});s.useEffect(()=>{sessionStorage.setItem("selectedUsers",JSON.stringify(n))},[n]);const i=s.useCallback(()=>{sessionStorage.removeItem("selectedUsers"),u([])},[]);return[n,u,i]};function De({users:r,filters:n}){const{props:u}=ee(),{auth:i}=u,m=u.flash||{},[d,p]=s.useState({isOpen:!1,userId:null,userName:""}),[f,N]=s.useState({isOpen:!1,count:0}),[l,o,M]=be([]),[I,y]=s.useState(!1),[C,E]=s.useState(n?.search||""),[S,_]=s.useState(n?.per_page||5),[h,O]=s.useState({key:n?.sort||"created_at",direction:n?.direction||"desc"}),{success:g,error:b}=te(),k=t=>i.user&&i.user.permissions&&i.user.permissions.includes(t),j=s.useRef({search:n?.search||"",per_page:n?.per_page||5,sort:n?.sort||"created_at",direction:n?.direction||"desc"});s.useEffect(()=>{const t={search:C,per_page:S,sort:h.key,direction:h.direction};if(t.search!==j.current.search||t.per_page!==j.current.per_page||t.sort!==j.current.sort||t.direction!==j.current.direction){const c=setTimeout(()=>{x.get(route("admin.users.index"),{search:C,sort:h.key,direction:h.direction,per_page:S},{preserveState:!0,replace:!0,preserveScroll:!0,onFinish:()=>{j.current=t}})},500);return()=>clearTimeout(c)}},[C,S,h]),s.useEffect(()=>{if(r&&r.data&&l.length>0){const t=r.data.map(v=>v.id),a=t.every(v=>l.includes(v)),c=t.some(v=>l.includes(v));y(!!a)}else y(!1)},[r,l]);const z=s.useCallback(t=>{x.visit(route("admin.users.show",t.id))},[]),$=s.useCallback(()=>{if(r&&r.data){const t=r.data.map(a=>a.id);o(I?a=>a.filter(c=>!t.includes(c)):a=>[...new Set([...a,...t])])}},[I,r,o]),J=s.useCallback(t=>{o(a=>a.includes(t)?a.filter(c=>c!==t):[...a,t])},[o]),A=s.useCallback((t,a)=>{p({isOpen:!0,userId:t,userName:a})},[]),H=s.useCallback(()=>{N({isOpen:!0,count:l.length})},[l.length]),w=s.useCallback(()=>{p({isOpen:!1,userId:null,userName:""})},[]),D=s.useCallback(()=>{N({isOpen:!1,count:0})},[]),V=s.useCallback(()=>{d.userId?x.delete(route("admin.users.destroy",d.userId),{onSuccess:()=>{g("User deleted successfully!"),w(),o(t=>t.filter(a=>a!==d.userId))},onError:()=>{b("Failed to delete user."),w()}}):w()},[d.userId,w,g,b,o]),q=s.useCallback(()=>{l.length>0&&x.post(route("admin.users.bulk-destroy"),{ids:l},{onSuccess:()=>{g(`${l.length} user(s) deleted successfully!`),M(),y(!1),D()},onError:()=>{b("Failed to delete selected users."),D()}})},[l,D,g,b,M]),G=s.useCallback(()=>{l.length>0&&x.post(route("admin.users.export"),{ids:l},{onSuccess:()=>{g("Export initiated successfully!")},onError:()=>{b("Failed to export users.")}})},[l,g,b]),P=s.useCallback(t=>{O(a=>{let c="asc";return a.key===t&&a.direction==="asc"&&(c="desc"),{key:t,direction:c}})},[]),W=s.useCallback(()=>{E(""),_(5),O({key:"created_at",direction:"desc"}),x.get(route("admin.users.index"),{},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{j.current={search:"",per_page:5,sort:"created_at",direction:"desc"}}})},[]),X=s.useCallback(t=>{_(t)},[]),U=s.useCallback(t=>h.key!==t?e.jsx(T,{className:"ml-1 h-4 w-4 opacity-50"}):h.direction==="asc"?e.jsx(T,{className:"ml-1 h-4 w-4"}):e.jsx(ie,{className:"ml-1 h-4 w-4"}),[h]),Y=s.useMemo(()=>[{key:"name",label:"Name",sortable:!0,onSort:()=>P("name"),sortIcon:U("name"),render:t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center",children:e.jsx("span",{className:"font-medium text-primary-800 dark:text-primary-200",children:t.name.charAt(0).toUpperCase()})})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-neutral-900 dark:text-white",children:t.name})})]})},{key:"email",label:"Email",sortable:!0,onSort:()=>P("email"),sortIcon:U("email"),render:t=>e.jsx("div",{className:"text-sm text-neutral-900 dark:text-white",children:t.email})},{key:"roles",label:"Roles",render:t=>e.jsx("div",{className:"flex flex-wrap gap-1",children:t.roles&&t.roles.map((a,c)=>e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800 dark:bg-primary-900/30 dark:text-primary-300",children:a.name},c))})},{key:"created_at",label:"Joined Date",sortable:!0,onSort:()=>P("created_at"),sortIcon:U("created_at"),render:t=>e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:new Date(t.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"})})}],[P,U]),K=s.useMemo(()=>e.jsxs("div",{className:"flex flex-col items-center justify-center text-neutral-400 dark:text-neutral-500",children:[e.jsx(L,{className:"h-12 w-12 mb-3 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No users found"}),e.jsx("p",{className:"mt-1 text-sm",children:"Get started by creating a new user"}),k("create users")&&e.jsx("div",{className:"mt-6",children:e.jsx(B,{href:route("admin.users.create"),children:e.jsxs(F,{className:"flex items-center bg-primary-600 hover:bg-primary-700 focus:ring-primary-500",children:[e.jsx(de,{className:"mr-2 h-5 w-5"}),"Add New User"]})})})]}),[]),Q=s.useCallback(t=>e.jsx(ge,{user:t,onView:()=>x.visit(route("admin.users.show",t.id)),onEdit:()=>x.visit(route("admin.users.edit",t.id)),onDelete:()=>A(t.id,t.name),hasEditPermission:k("edit users"),hasDeletePermission:k("delete users")}),[A]),Z=s.useMemo(()=>k("create users")?e.jsx(B,{href:route("admin.users.create"),children:e.jsxs(F,{className:"flex items-center bg-primary-600 hover:bg-primary-700 focus:ring-primary-500",children:[e.jsx(L,{className:"mr-2 h-5 w-5"}),"Add User"]})}):null,[]);return e.jsxs(re,{title:"Manage Users",children:[e.jsx(se,{title:"Manage Users"}),e.jsx(R,{isOpen:d.isOpen,onClose:w,onConfirm:V,title:"Confirm Delete",message:`Are you sure you want to delete user "${d.userName}"? This action cannot be undone.`,confirmText:"Delete User",cancelText:"Cancel"}),k("delete users")&&e.jsx(R,{isOpen:f.isOpen,onClose:D,onConfirm:q,title:"Confirm Bulk Delete",message:`Are you sure you want to delete ${f.count} selected user(s)? This action cannot be undone.`,confirmText:`Delete ${f.count} Users`,cancelText:"Cancel"}),e.jsxs(ae,{title:"User Management",description:"Manage all system users, their roles and permissions",createButton:Z,filters:e.jsx("div",{className:"mb-6",children:e.jsx(ce,{searchTerm:C,onSearchChange:E,perPage:S,onPerPageChange:X,onClearFilters:W})}),children:[m.success&&e.jsx("div",{className:"mb-8 bg-success-50 dark:bg-success-900/30 border border-success-200 dark:border-success-800 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-success-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-success-800 dark:text-success-200",children:m.success})})]})}),m.error&&e.jsx("div",{className:"mb-8 bg-error-50 dark:bg-error-900/30 border border-error-200 dark:border-error-800 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-error-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-error-800 dark:text-error-200",children:m.error})})]})}),k("delete users")&&l.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(le,{selectedCount:l.length,onBulkDelete:H,onBulkExport:G,onClearSelected:M})}),e.jsx("div",{className:"mb-6",children:e.jsx(ne,{columns:Y,data:r?.data||[],selectedItems:l,onSelectItem:J,onSelectAll:$,selectAll:I,emptyState:K,rowActions:Q,keyField:"id",onRowClick:z})}),r&&r.data&&r.data.length>0&&r.links&&r.links.length>3&&e.jsx(oe,{data:r})]})]})}export{De as default};
