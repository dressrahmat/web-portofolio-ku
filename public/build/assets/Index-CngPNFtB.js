import{b as Q,r as s,a as Z,g as x,j as e,h as O,i as ee,O as A,L as B,x as te,H as se,m as re,y as ae,f as le,n as ne}from"./app-Cvucz7kI.js";import{A as oe}from"./AdminLayout-T-97QMqi.js";import{C as ce,B as ie,D as de,P as ue,F as me}from"./Pagination-DnYDBYK2.js";import{C as R}from"./ConfirmationModal-_QISP9Ew.js";import{P as F}from"./PrimaryButton-CTDxlp8O.js";import{r as he}from"./index-DBVdEqAI.js";import"./Checkbox-Cy-UO9Oz.js";import"./DangerButton-bp3TuekG.js";const xe=({trigger:r,children:n,position:d="bottom-right"})=>{const[o,c]=s.useState({top:0,left:0,width:0}),p=s.useRef(null),[k,j]=s.useState(!1),l=()=>{if(p.current){const m=p.current.getBoundingClientRect();c({top:m.bottom+window.scrollY,left:m.left+window.scrollX,width:m.width})}},u=()=>{switch(d){case"bottom-left":return"origin-top-left left-0";case"bottom-right":return"origin-top-right right-0";default:return"origin-top-right right-0"}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:p,onClick:()=>{l(),j(!0)},children:r}),k&&he.createPortal(e.jsx("div",{className:"fixed inset-0 z-50",onClick:()=>j(!1),children:e.jsx("div",{className:`absolute mt-1 w-48 rounded-md shadow-lg bg-neutral-50 dark:bg-neutral-800 ring-1 ring-primary-500 ring-opacity-20 focus:outline-none ${u()}`,style:{top:o.top,left:d==="bottom-right"?"auto":o.left,right:d==="bottom-right"?window.innerWidth-o.left-o.width:"auto",zIndex:9999},onClick:m=>m.stopPropagation(),children:n})}),document.body)]})},pe=({user:r,onView:n,onEdit:d,onDelete:o})=>{const c=e.jsx("button",{className:"inline-flex justify-center w-full p-2 text-sm font-medium text-primary-600 dark:text-primary-400 bg-neutral-50 dark:bg-neutral-800 rounded-md hover:bg-primary-50 dark:hover:bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:e.jsx(ne,{className:"h-4 w-4","aria-hidden":"true"})});return e.jsx(xe,{trigger:c,position:"bottom-right",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:n,className:"group flex items-center w-full px-4 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-primary-50 dark:hover:bg-neutral-700 hover:text-primary-600 dark:hover:text-primary-400",children:[e.jsx(re,{className:"mr-3 h-4 w-4","aria-hidden":"true"}),"View"]}),e.jsxs("button",{onClick:d,className:"group flex items-center w-full px-4 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-primary-50 dark:hover:bg-neutral-700 hover:text-primary-600 dark:hover:text-primary-400",children:[e.jsx(ae,{className:"mr-3 h-4 w-4","aria-hidden":"true"}),"Edit"]}),e.jsxs("button",{onClick:o,className:"group flex items-center w-full px-4 py-2 text-sm text-error-600 dark:text-error-400 hover:bg-error-50 dark:hover:bg-error-900/30 hover:text-error-700 dark:hover:text-error-300",children:[e.jsx(le,{className:"mr-3 h-4 w-4","aria-hidden":"true"}),"Delete"]})]})})},fe=(r=[])=>{const[n,d]=s.useState(()=>{try{const c=sessionStorage.getItem("selectedUsers");return c?JSON.parse(c):r}catch{return r}});s.useEffect(()=>{sessionStorage.setItem("selectedUsers",JSON.stringify(n))},[n]);const o=s.useCallback(()=>{sessionStorage.removeItem("selectedUsers"),d([])},[]);return[n,d,o]};function Ce({users:r,filters:n}){const{props:d}=Q(),o=d.flash||{},[c,p]=s.useState({isOpen:!1,userId:null,userName:""}),[k,j]=s.useState({isOpen:!1,count:0}),[l,u,m]=fe([]),[U,y]=s.useState(!1),[N,M]=s.useState(n?.search||""),[C,I]=s.useState(n?.per_page||5),[h,_]=s.useState({key:n?.sort||"created_at",direction:n?.direction||"desc"}),{success:f,error:g}=Z(),b=s.useRef({search:n?.search||"",per_page:n?.per_page||5,sort:n?.sort||"created_at",direction:n?.direction||"desc"});s.useEffect(()=>{const t={search:N,per_page:C,sort:h.key,direction:h.direction};if(t.search!==b.current.search||t.per_page!==b.current.per_page||t.sort!==b.current.sort||t.direction!==b.current.direction){const i=setTimeout(()=>{x.get(route("admin.users.index"),{search:N,sort:h.key,direction:h.direction,per_page:C},{preserveState:!0,replace:!0,preserveScroll:!0,onFinish:()=>{b.current=t}})},500);return()=>clearTimeout(i)}},[N,C,h]),s.useEffect(()=>{if(r&&r.data&&l.length>0){const t=r.data.map(v=>v.id),a=t.every(v=>l.includes(v)),i=t.some(v=>l.includes(v));y(!!a)}else y(!1)},[r,l]);const T=s.useCallback(t=>{x.visit(route("admin.users.show",t.id))},[]),L=s.useCallback(()=>{if(r&&r.data){const t=r.data.map(a=>a.id);u(U?a=>a.filter(i=>!t.includes(i)):a=>[...new Set([...a,...t])])}},[U,r,u]),z=s.useCallback(t=>{u(a=>a.includes(t)?a.filter(i=>i!==t):[...a,t])},[u]),E=s.useCallback((t,a)=>{p({isOpen:!0,userId:t,userName:a})},[]),$=s.useCallback(()=>{j({isOpen:!0,count:l.length})},[l.length]),w=s.useCallback(()=>{p({isOpen:!1,userId:null,userName:""})},[]),S=s.useCallback(()=>{j({isOpen:!1,count:0})},[]),J=s.useCallback(()=>{c.userId?x.delete(route("admin.users.destroy",c.userId),{onSuccess:()=>{f("User deleted successfully!"),w(),u(t=>t.filter(a=>a!==c.userId))},onError:()=>{g("Failed to delete user."),w()}}):w()},[c.userId,w,f,g,u]),H=s.useCallback(()=>{l.length>0&&x.post(route("admin.users.bulk-destroy"),{ids:l},{onSuccess:()=>{f(`${l.length} user(s) deleted successfully!`),m(),y(!1),S()},onError:()=>{g("Failed to delete selected users."),S()}})},[l,S,f,g,m]),V=s.useCallback(()=>{l.length>0&&x.post(route("admin.users.export"),{ids:l},{onSuccess:()=>{f("Export initiated successfully!")},onError:()=>{g("Failed to export users.")}})},[l,f,g]),D=s.useCallback(t=>{_(a=>{let i="asc";return a.key===t&&a.direction==="asc"&&(i="desc"),{key:t,direction:i}})},[]),G=s.useCallback(()=>{M(""),I(5),_({key:"created_at",direction:"desc"}),x.get(route("admin.users.index"),{},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{b.current={search:"",per_page:5,sort:"created_at",direction:"desc"}}})},[]),W=s.useCallback(t=>{I(t)},[]),P=s.useCallback(t=>h.key!==t?e.jsx(O,{className:"ml-1 h-4 w-4 opacity-50"}):h.direction==="asc"?e.jsx(O,{className:"ml-1 h-4 w-4"}):e.jsx(ee,{className:"ml-1 h-4 w-4"}),[h]),X=s.useMemo(()=>[{key:"name",label:"Name",sortable:!0,onSort:()=>D("name"),sortIcon:P("name"),render:t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center",children:e.jsx("span",{className:"font-medium text-primary-800 dark:text-primary-200",children:t.name.charAt(0).toUpperCase()})})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-neutral-900 dark:text-white",children:t.name})})]})},{key:"email",label:"Email",sortable:!0,onSort:()=>D("email"),sortIcon:P("email"),render:t=>e.jsx("div",{className:"text-sm text-neutral-900 dark:text-white",children:t.email})},{key:"roles",label:"Roles",render:t=>e.jsx("div",{className:"flex flex-wrap gap-1",children:t.roles&&t.roles.map((a,i)=>e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800 dark:bg-primary-900/30 dark:text-primary-300",children:a.name},i))})},{key:"created_at",label:"Joined Date",sortable:!0,onSort:()=>D("created_at"),sortIcon:P("created_at"),render:t=>e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:new Date(t.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"})})}],[D,P]),Y=s.useMemo(()=>e.jsxs("div",{className:"flex flex-col items-center justify-center text-neutral-400 dark:text-neutral-500",children:[e.jsx(A,{className:"h-12 w-12 mb-3 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No users found"}),e.jsx("p",{className:"mt-1 text-sm",children:"Get started by creating a new user"}),e.jsx("div",{className:"mt-6",children:e.jsx(B,{href:route("admin.users.create"),children:e.jsxs(F,{className:"flex items-center bg-primary-600 hover:bg-primary-700 focus:ring-primary-500",children:[e.jsx(te,{className:"mr-2 h-5 w-5"}),"Add New User"]})})})]}),[]),q=s.useCallback(t=>e.jsx(pe,{user:t,onView:()=>x.visit(route("admin.users.show",t.id)),onEdit:()=>x.visit(route("admin.users.edit",t.id)),onDelete:()=>E(t.id,t.name)}),[E]),K=s.useMemo(()=>e.jsx(B,{href:route("admin.users.create"),children:e.jsxs(F,{className:"flex items-center bg-primary-600 hover:bg-primary-700 focus:ring-primary-500",children:[e.jsx(A,{className:"mr-2 h-5 w-5"}),"Add User"]})}),[]);return e.jsxs(oe,{title:"Manage Users",children:[e.jsx(se,{title:"Manage Users"}),e.jsx(R,{isOpen:c.isOpen,onClose:w,onConfirm:J,title:"Confirm Delete",message:`Are you sure you want to delete user "${c.userName}"? This action cannot be undone.`,confirmText:"Delete User",cancelText:"Cancel"}),e.jsx(R,{isOpen:k.isOpen,onClose:S,onConfirm:H,title:"Confirm Bulk Delete",message:`Are you sure you want to delete ${k.count} selected user(s)? This action cannot be undone.`,confirmText:`Delete ${k.count} Users`,cancelText:"Cancel"}),e.jsxs(ce,{title:"User Management",description:"Manage all system users, their roles and permissions",createButton:K,filters:e.jsx("div",{className:"mb-6",children:e.jsx(me,{searchTerm:N,onSearchChange:M,perPage:C,onPerPageChange:W,onClearFilters:G})}),children:[o.success&&e.jsx("div",{className:"mb-8 bg-success-50 dark:bg-success-900/30 border border-success-200 dark:border-success-800 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-success-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-success-800 dark:text-success-200",children:o.success})})]})}),o.error&&e.jsx("div",{className:"mb-8 bg-error-50 dark:bg-error-900/30 border border-error-200 dark:border-error-800 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-error-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-error-800 dark:text-error-200",children:o.error})})]})}),l.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(ie,{selectedCount:l.length,onBulkDelete:$,onBulkExport:V,onClearSelected:m})}),e.jsx("div",{className:"mb-6",children:e.jsx(de,{columns:X,data:r?.data||[],selectedItems:l,onSelectItem:z,onSelectAll:L,selectAll:U,emptyState:Y,rowActions:q,keyField:"id",onRowClick:T})}),r&&r.data&&r.data.length>0&&r.links&&r.links.length>3&&e.jsx(ue,{data:r})]})]})}export{Ce as default};
