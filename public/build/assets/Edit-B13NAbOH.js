import{u as W,r as c,a as T,b as H,j as e,H as O,L as V,c as j}from"./app-Br-_wUYX.js";import{A as q}from"./AdminLayout-_UXcoW4f.js";import{I as p,T as _}from"./InputError-D1VyfXUl.js";import{P as E}from"./PasswordInput-PhvCBMpn.js";import{I as x}from"./InputLabel-ABc6Updu.js";import{P as $}from"./PrimaryButton-kFRxeKdj.js";import{F as X,a as R,d as G,b as J,c as K}from"./index-DGBmX_sI.js";function ae({user:a,roles:U}){const A=Array.isArray(a.roles)?a.roles.map(r=>typeof r=="object"?r.name:r):[],{data:s,setData:o,errors:n,put:L,processing:P,reset:I}=W({name:a.name,email:a.email,password:"",password_confirmation:"",foto:null,remove_photo:!1,roles:A,_method:"PUT"}),b=()=>a.foto_path&&!s.remove_photo?`/storage/${a.foto_path}`:null,[l,g]=c.useState(b()),[m,w]=c.useState(!1),[h,F]=c.useState(!1),u=c.useRef(null),{success:v,error:d}=T(),{props:S}=H(),f=S.flash||{};c.useEffect(()=>{f.success&&v(f.success),f.error&&d(f.error)},[f]),c.useEffect(()=>{!s.foto&&!l?.startsWith("blob:")&&g(b())},[a.foto_path,s.remove_photo]),c.useEffect(()=>()=>{l&&l.startsWith("blob:")&&URL.revokeObjectURL(l)},[l]);const z=async r=>{const t=r.target.files[0];if(t){if(!t.type.startsWith("image/")){d("Please select an image file");return}if(t.size>2*1024*1024){d("Image size must be less than 2MB");return}w(!0);try{const i=new FormData;i.append("foto",t),j.post(route("admin.users.update-photo",a.id),i,{forceFormData:!0,onSuccess:()=>{v("Profile photo updated successfully!");const k=URL.createObjectURL(t);g(k),o("foto",null),o("remove_photo",!1),j.reload({only:["user"]})},onError:k=>{d(k.foto||"Failed to upload photo")},onFinish:()=>{w(!1),u.current&&(u.current.value="")}})}catch(i){d("Failed to upload photo"),console.error("Upload error:",i),w(!1)}}},D=()=>{l&&l.startsWith("blob:")&&URL.revokeObjectURL(l),g(b()),o("foto",null),u.current&&(u.current.value="")},B=()=>{F(!0),j.post(route("admin.users.remove-photo",a.id),{},{onSuccess:()=>{v("Profile photo removed successfully!"),g(null),o("remove_photo",!0),j.reload({only:["user"]})},onError:r=>{d(r.message||"Failed to remove photo")},onFinish:()=>{F(!1)}})},M=r=>{r.preventDefault();const t=new FormData;t.append("name",s.name),t.append("email",s.email),t.append("password",s.password),t.append("password_confirmation",s.password_confirmation),t.append("remove_photo",s.remove_photo?"1":"0"),t.append("_method","PUT"),Array.isArray(s.roles)&&s.roles.forEach(i=>t.append("roles[]",i)),s.foto&&t.append("foto",s.foto),L(route("admin.users.update",a.id),{data:t,forceFormData:!0,onSuccess:()=>{v("User updated successfully!"),I("password","password_confirmation")},onError:i=>{d("Failed to update user. Please check the form.")}})},C=()=>{!m&&!h&&u.current?.click()},N=a.foto_path&&!s.remove_photo,y=s.foto;return e.jsxs(q,{title:"Edit User",children:[e.jsx(O,{title:"Edit User"}),e.jsx("div",{className:"mx-auto px-1 lg:px-4 lg:pt-2",children:e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-800 rounded-xl shadow-card p-6 sm:p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-neutral-900 dark:text-white",children:["Edit User: ",a.name]}),e.jsx("p",{className:"text-neutral-600 dark:text-neutral-400 mt-2",children:"Update user information, roles, and permissions."})]}),e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"foto",value:"Profile Photo"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:`w-24 h-24 rounded-full border-2 border-dashed border-neutral-300 dark:border-neutral-600 bg-neutral-50 dark:bg-neutral-700 flex items-center justify-center cursor-pointer hover:border-neutral-400 dark:hover:border-neutral-500 transition-colors ${m||h?"opacity-50 cursor-not-allowed":""}`,onClick:C,children:m?e.jsxs("div",{className:"text-center",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-neutral-400 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Uploading..."})]}):h?e.jsxs("div",{className:"text-center",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-neutral-400 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:"Removing..."})]}):l?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:l,alt:"Profile preview",className:"w-full h-full rounded-full object-cover"}),e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),D()},className:"absolute -top-2 -right-2 bg-error-500 text-white rounded-full p-1 hover:bg-error-600 transition-colors",disabled:m,children:e.jsx(X,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsx(R,{className:"w-8 h-8 text-neutral-400 mx-auto mb-1"}),e.jsx("span",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"Upload"})]})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-2",children:N||y?"Change profile photo (max 2MB)":"Upload a profile photo (max 2MB)"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:C,className:"inline-flex items-center px-4 py-2 bg-neutral-100 dark:bg-neutral-700 border border-neutral-300 dark:border-neutral-600 rounded-md font-medium text-neutral-700 dark:text-neutral-300 hover:bg-neutral-200 dark:hover:bg-neutral-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-neutral-800 text-sm",disabled:m||h,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),N||y?"Change Photo":"Select Photo"]}),(N||y)&&e.jsxs("button",{type:"button",onClick:B,className:"inline-flex items-center px-4 py-2 bg-error-100 dark:bg-error-900/30 border border-error-300 dark:border-error-700 rounded-md font-medium text-error-700 dark:text-error-300 hover:bg-error-200 dark:hover:bg-error-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-neutral-800 text-sm",disabled:m||h,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Remove Photo"]})]})]})]}),e.jsx("input",{ref:u,type:"file",id:"foto",name:"foto",accept:"image/*",onChange:z,className:"hidden"}),e.jsx(p,{message:n.foto})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"name",value:"Full Name",required:!0}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{id:"name",type:"text",value:s.name,onChange:r=>o("name",r.target.value),error:n.name,placeholder:"Enter full name",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(J,{className:"h-5 w-5 text-primary-400"})})]}),e.jsx(p,{message:n.name})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"email",value:"Email Address",required:!0}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{id:"email",type:"email",value:s.email,onChange:r=>o("email",r.target.value),error:n.email,placeholder:"Enter email address",className:"pl-10"}),e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(K,{className:"h-5 w-5 text-primary-400"})})]}),e.jsx(p,{message:n.email})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"roles",value:"User Roles"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mt-2",children:U&&U.map(r=>e.jsxs("label",{className:"flex items-center p-3 border border-neutral-300 dark:border-neutral-600 rounded-lg cursor-pointer hover:bg-neutral-50 dark:hover:bg-neutral-700 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:Array.isArray(s.roles)&&s.roles.includes(r),onChange:t=>{t.target.checked?o("roles",[...s.roles||[],r]):o("roles",(s.roles||[]).filter(i=>i!==r))},className:"rounded border-neutral-300 text-primary-600 shadow-sm focus:ring-primary-500"}),e.jsx("span",{className:"ml-3 text-sm font-medium text-neutral-700 dark:text-neutral-300",children:r})]},r))}),e.jsx(p,{message:n.roles})]}),e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-700/50 p-2 rounded-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-white mb-4",children:"Update Password"}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-4",children:"Leave blank to keep the current password."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"password",value:"New Password"}),e.jsx(E,{id:"password",value:s.password,onChange:r=>o("password",r.target.value),error:n.password,placeholder:"Enter new password"}),e.jsx(p,{message:n.password})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"password_confirmation",value:"Confirm New Password"}),e.jsx(E,{id:"password_confirmation",value:s.password_confirmation,onChange:r=>o("password_confirmation",r.target.value),placeholder:"Confirm new password"}),e.jsx(p,{message:n.password_confirmation})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 pt-6 border-t border-neutral-200 dark:border-neutral-700",children:[e.jsx(V,{href:route("admin.users.index"),className:"inline-flex items-center justify-center px-6 py-3 border border-neutral-300 rounded-lg text-neutral-700 hover:bg-neutral-50 dark:border-neutral-600 dark:text-neutral-300 dark:hover:bg-neutral-700 transition-colors duration-200 font-medium",children:"Cancel"}),e.jsx($,{type:"submit",disabled:P,className:"px-6 py-3 bg-primary-600 hover:bg-primary-700 focus:ring-primary-500",children:P?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Updating..."]}):"Update User"})]})]})]})})]})}export{ae as default};
