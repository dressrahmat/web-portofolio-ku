import{b as te,r as t,a as ae,g as k,j as e,h as G,i as ne,q as B,p as E,L as R,x as I,H as le,y as oe,f as ie,n as ce}from"./app-Cvucz7kI.js";import{A as de}from"./AdminLayout-T-97QMqi.js";import{C as me,B as ue,D as xe,P as he,F as pe}from"./Pagination-DnYDBYK2.js";import{C as H}from"./ConfirmationModal-_QISP9Ew.js";import{P as _}from"./PrimaryButton-CTDxlp8O.js";import{r as ge}from"./index-DBVdEqAI.js";import"./Checkbox-Cy-UO9Oz.js";import"./DangerButton-bp3TuekG.js";const fe=({trigger:n,children:l,position:r="bottom-right"})=>{const[i,m]=t.useState({top:0,left:0,width:0}),d=t.useRef(null),[o,N]=t.useState(!1),x=()=>{if(d.current){const p=d.current.getBoundingClientRect();m({top:p.bottom+window.scrollY,left:p.left+window.scrollX,width:p.width})}},y=()=>{switch(r){case"bottom-left":return"origin-top-left left-0";case"bottom-right":return"origin-top-right right-0";default:return"origin-top-right right-0"}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:d,onClick:()=>{x(),N(!0)},children:n}),o&&ge.createPortal(e.jsx("div",{className:"fixed inset-0 z-50",onClick:()=>N(!1),children:e.jsx("div",{className:`absolute mt-1 w-48 rounded-xl shadow-card bg-neutral-50 dark:bg-neutral-800 ring-1 ring-primary-500 ring-opacity-20 focus:outline-none ${y()}`,style:{top:i.top,left:r==="bottom-right"?"auto":i.left,right:r==="bottom-right"?window.innerWidth-i.left-i.width:"auto",zIndex:9999},onClick:p=>p.stopPropagation(),children:l})}),document.body)]})},be=({item:n,type:l,onEdit:r,onDelete:i})=>{const m=e.jsx("button",{className:"inline-flex justify-center w-full p-2 text-sm font-medium text-primary-600 dark:text-primary-400 bg-neutral-50 dark:bg-neutral-800 rounded-md hover:bg-primary-50 dark:hover:bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:e.jsx(ce,{className:"h-4 w-4","aria-hidden":"true"})});return e.jsx(fe,{trigger:m,position:"bottom-right",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:r,className:"group flex items-center w-full px-4 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-primary-50 dark:hover:bg-neutral-700 hover:text-primary-600 dark:hover:text-primary-400",children:[e.jsx(oe,{className:"mr-3 h-4 w-4","aria-hidden":"true"}),"Edit"]}),e.jsxs("button",{onClick:i,className:"group flex items-center w-full px-4 py-2 text-sm text-error-600 dark:text-error-400 hover:bg-error-50 dark:hover:bg-error-900/30 hover:text-error-700 dark:hover:text-error-300",children:[e.jsx(ie,{className:"mr-3 h-4 w-4","aria-hidden":"true"}),"Delete"]})]})})},je=(n=[],l="selectedItems")=>{const[r,i]=t.useState(()=>{try{const d=sessionStorage.getItem(l);return d?JSON.parse(d):n}catch{return n}});t.useEffect(()=>{sessionStorage.setItem(l,JSON.stringify(r))},[r,l]);const m=t.useCallback(()=>{sessionStorage.removeItem(l),i([])},[l]);return[r,i,m]};function De({data:n,filters:l,type:r}){const{props:i}=te(),m=i.flash||{},d=i.auth||{},[o,N]=t.useState({isOpen:!1,id:null,name:"",type:""}),[x,y]=t.useState({isOpen:!1,count:0,type:""}),p=`selectedItems_${r}`,[u,g,v]=je([],p),[A,$]=t.useState(!1),[C,F]=t.useState(l?.search||""),[S,O]=t.useState(l?.per_page||10),[h,T]=t.useState({key:l?.sort||"name",direction:l?.direction||"asc"}),{success:P,error:D}=ae(),f=t.useRef({search:l?.search||"",per_page:l?.per_page||10,sort:l?.sort||"name",direction:l?.direction||"asc"});t.useEffect(()=>{const s={search:C,per_page:S,sort:h.key,direction:h.direction};if(s.search!==f.current.search||s.per_page!==f.current.per_page||s.sort!==f.current.sort||s.direction!==f.current.direction){const c=setTimeout(()=>{k.get(route("admin.role-permissions.index"),{search:C,sort:h.key,direction:h.direction,per_page:S,type:r},{preserveState:!0,replace:!0,preserveScroll:!0,onFinish:()=>{f.current=s}})},500);return()=>clearTimeout(c)}},[C,S,h,r]),t.useEffect(()=>{v(),$(!1)},[r,v]);const J=t.useCallback(()=>{if(n&&n.data){const s=n.data.map(a=>a.id);g(A?a=>a.filter(c=>!s.includes(c)):a=>[...new Set([...a,...s])])}},[A,n,g]),q=t.useCallback(s=>{g(a=>a.includes(s)?a.filter(c=>c!==s):[...a,s])},[g]),L=t.useCallback((s,a,c)=>{N({isOpen:!0,id:s,name:a,type:c})},[]),U=t.useCallback(()=>{y({isOpen:!0,count:u.length,type:r})},[u.length,r]),w=t.useCallback(()=>{N({isOpen:!1,id:null,name:"",type:""})},[]),M=t.useCallback(()=>{y({isOpen:!1,count:0,type:""})},[]),W=t.useCallback(()=>{if(o.id){const s=o.type==="roles"?"admin.roles.destroy":"admin.permissions.destroy";k.delete(route(s,o.id),{onSuccess:()=>{P(`${o.type==="roles"?"Role":"Permission"} deleted successfully!`),w(),g(a=>a.filter(c=>c!==o.id))},onError:()=>{D(`Failed to delete ${o.type==="roles"?"role":"permission"}.`),w()}})}else w()},[o.id,o.type,w,P,D,g]),X=t.useCallback(()=>{if(u.length>0){const s=r==="roles"?"admin.roles.bulk-destroy":"admin.permissions.bulk-destroy";k.post(route(s),{ids:u},{onSuccess:()=>{P(`${u.length} ${r==="roles"?"role(s)":"permission(s)"} deleted successfully!`),v(),$(!1),M()},onError:()=>{D(`Failed to delete selected ${r==="roles"?"roles":"permissions"}.`),M()}})}},[u,r,M,P,D,v]),b=t.useCallback(s=>{T(a=>{let c="asc";return a.key===s&&a.direction==="asc"&&(c="desc"),{key:s,direction:c}})},[]),Y=t.useCallback(()=>{F(""),O(10),T({key:"name",direction:"asc"}),k.get(route("admin.role-permissions.index"),{type:r,search:"",per_page:10,sort:"name",direction:"asc"},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{f.current={search:"",per_page:10,sort:"name",direction:"asc"}}})},[r]),Q=t.useCallback(s=>{O(s)},[]),j=t.useCallback(s=>h.key!==s?e.jsx(G,{className:"ml-1 h-4 w-4 opacity-50"}):h.direction==="asc"?e.jsx(G,{className:"ml-1 h-4 w-4"}):e.jsx(ne,{className:"ml-1 h-4 w-4"}),[h]),z=t.useCallback(s=>{F(""),O(10),T({key:"name",direction:"asc"}),k.get(route("admin.role-permissions.index"),{type:s,search:"",per_page:10,sort:"name",direction:"asc"},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{f.current={search:"",per_page:10,sort:"name",direction:"asc"}}})},[]),V=t.useMemo(()=>[{key:"name",label:"Role Name",sortable:!0,onSort:()=>b("name"),sortIcon:j("name"),render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center",children:e.jsx(B,{className:"h-5 w-5 text-primary-600 dark:text-primary-400"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-900 dark:text-white",children:s.name}),e.jsxs("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:[s.users_count," user(s)"]})]})]})},{key:"permissions",label:"Permissions",sortable:!1,render:s=>e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.permissions?.slice(0,3).map(a=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-accent-100 dark:bg-accent-900/30 text-accent-800 dark:text-accent-300",children:a.name},a.id)),s.permissions&&s.permissions.length>3&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-neutral-100 dark:bg-neutral-700 text-neutral-800 dark:text-neutral-300",children:["+",s.permissions.length-3," more"]})]})},{key:"created_at",label:"Created At",sortable:!0,onSort:()=>b("created_at"),sortIcon:j("created_at"),render:s=>e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:new Date(s.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"})})}],[b,j]),Z=t.useMemo(()=>[{key:"name",label:"Permission Name",sortable:!0,onSort:()=>b("name"),sortIcon:j("name"),render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-accent-100 dark:bg-accent-900/30 flex items-center justify-center",children:e.jsx(E,{className:"h-5 w-5 text-accent-600 dark:text-accent-400"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-900 dark:text-white",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:s.description})]})]})},{key:"roles",label:"Assigned Roles",sortable:!1,render:s=>e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.roles?.slice(0,3).map(a=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-success-100 dark:bg-success-900/30 text-success-800 dark:text-success-300",children:a.name},a.id)),s.roles&&s.roles.length>3&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-neutral-100 dark:bg-neutral-700 text-neutral-800 dark:text-neutral-300",children:["+",s.roles.length-3," more"]})]})},{key:"created_at",label:"Created At",sortable:!0,onSort:()=>b("created_at"),sortIcon:j("created_at"),render:s=>e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:new Date(s.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"})})}],[b,j]),K=r==="roles"?V:Z,ee=t.useMemo(()=>e.jsx("div",{className:"flex flex-col items-center justify-center text-neutral-400 dark:text-neutral-500",children:r==="roles"?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-12 w-12 mb-3 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No roles found"}),e.jsx("p",{className:"mt-1 text-sm",children:"Get started by creating a new role"}),e.jsx("div",{className:"mt-6",children:e.jsx(R,{href:route("admin.roles.create"),children:e.jsxs(_,{className:"flex items-center bg-primary-600 hover:bg-primary-700 focus:ring-primary-500",children:[e.jsx(I,{className:"mr-2 h-5 w-5"}),"Add New Role"]})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-12 w-12 mb-3 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No permissions found"}),e.jsx("p",{className:"mt-1 text-sm",children:"Get started by creating a new permission"}),e.jsx("div",{className:"mt-6",children:e.jsx(R,{href:route("admin.permissions.create"),children:e.jsxs(_,{className:"flex items-center bg-accent-600 hover:bg-accent-700 focus:ring-accent-500",children:[e.jsx(I,{className:"mr-2 h-5 w-5"}),"Add New Permission"]})})})]})}),[r]),se=t.useCallback(s=>e.jsx(be,{item:s,type:r,onEdit:()=>k.visit(route(r==="roles"?"admin.roles.edit":"admin.permissions.edit",s.id)),onDelete:()=>L(s.id,s.name,r)}),[r,L]),re=t.useMemo(()=>r==="roles"?e.jsx(R,{href:route("admin.roles.create"),children:e.jsxs(_,{className:"flex items-center bg-primary-600 hover:bg-primary-700 focus:ring-primary-500",children:[e.jsx(I,{className:"mr-2 h-5 w-5"}),"Add Role"]})}):e.jsx(R,{href:route("admin.permissions.create"),children:e.jsxs(_,{className:"flex items-center bg-accent-600 hover:bg-accent-700 focus:ring-accent-500",children:[e.jsx(I,{className:"mr-2 h-5 w-5"}),"Add Permission"]})}),[r]);return d.user?.permissions?.includes("manage.roles")||d.user?.roles?.includes("master"),d.user?.permissions?.includes("manage.permissions")||d.user?.roles?.includes("master"),e.jsxs(de,{title:r==="roles"?"Manage Roles":"Manage Permissions",children:[e.jsx(le,{title:r==="roles"?"Manage Roles":"Manage Permissions"}),e.jsx(H,{isOpen:o.isOpen,onClose:w,onConfirm:W,title:`Confirm Delete ${o.type==="roles"?"Role":"Permission"}`,message:`Are you sure you want to delete ${o.type==="roles"?"role":"permission"} "${o.name}"? This action cannot be undone.`,confirmText:`Delete ${o.type==="roles"?"Role":"Permission"}`,cancelText:"Cancel"}),e.jsx(H,{isOpen:x.isOpen,onClose:M,onConfirm:X,title:`Confirm Bulk Delete ${x.type==="roles"?"Roles":"Permissions"}`,message:`Are you sure you want to delete ${x.count} selected ${x.type==="roles"?"role(s)":"permission(s)"}? This action cannot be undone.`,confirmText:`Delete ${x.count} ${x.type==="roles"?"Roles":"Permissions"}`,cancelText:"Cancel"}),e.jsxs(me,{title:r==="roles"?"Role Management":"Permission Management",description:r==="roles"?"Manage user roles and their permissions":"Manage system permissions and assign them to roles",createButton:re,filters:e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsxs("button",{onClick:()=>z("roles"),className:`px-4 py-2 rounded-xl text-sm font-medium ${r==="roles"?"bg-primary-600 text-white":"bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-300 dark:hover:bg-neutral-600"}`,children:[e.jsx(B,{className:"inline mr-2 h-4 w-4"}),"Roles"]}),e.jsxs("button",{onClick:()=>z("permissions"),className:`px-4 py-2 rounded-xl text-sm font-medium ${r==="permissions"?"bg-accent-600 text-white":"bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-300 dark:hover:bg-neutral-600"}`,children:[e.jsx(E,{className:"inline mr-2 h-4 w-4"}),"Permissions"]})]})}),e.jsx(pe,{searchTerm:C,onSearchChange:F,perPage:S,onPerPageChange:Q,onClearFilters:Y})]}),children:[m.success&&e.jsx("div",{className:"mb-8 bg-success-50 dark:bg-success-900/30 border border-success-200 dark:border-success-800 rounded-xl p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-success-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-success-800 dark:text-success-200",children:m.success})})]})}),m.error&&e.jsx("div",{className:"mb-8 bg-error-50 dark:bg-error-900/30 border border-error-200 dark:border-error-800 rounded-xl p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-error-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-error-800 dark:text-error-200",children:m.error})})]})}),u.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(ue,{selectedCount:u.length,onBulkDelete:U,onClearSelected:()=>{v(),$(!1)}})}),e.jsx("div",{className:"mb-6",children:e.jsx(xe,{columns:K,data:n?.data||[],selectedItems:u,onSelectItem:q,onSelectAll:J,selectAll:A,emptyState:ee,rowActions:se,keyField:"id"},r)}),n&&n.data&&n.data.length>0&&n.links&&n.links.length>3&&e.jsx(he,{data:n,filters:{type:r}})]})]})}export{De as default};
