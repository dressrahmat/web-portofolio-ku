import{b as ae,r as t,a as ne,c as N,j as e,L as I,H as le}from"./app-Br-_wUYX.js";import{A as oe}from"./AdminLayout-_UXcoW4f.js";import{C as ie,B as ce,D as de,P as me,F as ue}from"./Pagination-CKCo_V0E.js";import{C as H}from"./ConfirmationModal-DcKu0yb-.js";import{P as _}from"./PrimaryButton-kFRxeKdj.js";import{e as J,f as xe,A as E,z as L,q as A,v as he,d as pe,j as ge}from"./index-DGBmX_sI.js";import{r as fe}from"./index-Dq7a4Tri.js";import"./Checkbox-CWDnwgLm.js";const be=({trigger:n,children:l,position:r="bottom-right"})=>{const[c,u]=t.useState({top:0,left:0,width:0}),i=t.useRef(null),[o,v]=t.useState(!1),h=()=>{if(i.current){const g=i.current.getBoundingClientRect();u({top:g.bottom+window.scrollY,left:g.left+window.scrollX,width:g.width})}},C=()=>{switch(r){case"bottom-left":return"origin-top-left left-0";case"bottom-right":return"origin-top-right right-0";default:return"origin-top-right right-0"}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:i,onClick:()=>{h(),v(!0)},children:n}),o&&fe.createPortal(e.jsx("div",{className:"fixed inset-0 z-50",onClick:()=>v(!1),children:e.jsx("div",{className:`absolute mt-1 w-48 rounded-xl shadow-card bg-neutral-50 dark:bg-neutral-800 ring-1 ring-primary-500 ring-opacity-20 focus:outline-none ${C()}`,style:{top:c.top,left:r==="bottom-right"?"auto":c.left,right:r==="bottom-right"?window.innerWidth-c.left-c.width:"auto",zIndex:9999},onClick:g=>g.stopPropagation(),children:l})}),document.body)]})},je=({item:n,type:l,onEdit:r,onDelete:c,hasEditPermission:u,hasDeletePermission:i})=>{const o=e.jsx("button",{className:"inline-flex justify-center w-full p-2 text-sm font-medium text-primary-600 dark:text-primary-400 bg-neutral-50 dark:bg-neutral-800 rounded-md hover:bg-primary-50 dark:hover:bg-neutral-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:e.jsx(ge,{className:"h-4 w-4","aria-hidden":"true"})});return e.jsx(be,{trigger:o,position:"bottom-right",children:e.jsxs("div",{className:"py-1",children:[u&&e.jsxs("button",{onClick:r,className:"group flex items-center w-full px-4 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-primary-50 dark:hover:bg-neutral-700 hover:text-primary-600 dark:hover:text-primary-400",children:[e.jsx(he,{className:"mr-3 h-4 w-4","aria-hidden":"true"}),"Edit"]}),i&&e.jsxs("button",{onClick:c,className:"group flex items-center w-full px-4 py-2 text-sm text-error-600 dark:text-error-400 hover:bg-error-50 dark:hover:bg-error-900/30 hover:text-error-700 dark:hover:text-error-300",children:[e.jsx(pe,{className:"mr-3 h-4 w-4","aria-hidden":"true"}),"Delete"]})]})})},ke=(n=[],l="selectedItems")=>{const[r,c]=t.useState(()=>{try{const i=sessionStorage.getItem(l);return i?JSON.parse(i):n}catch{return n}});t.useEffect(()=>{sessionStorage.setItem(l,JSON.stringify(r))},[r,l]);const u=t.useCallback(()=>{sessionStorage.removeItem(l),c([])},[l]);return[r,c,u]};function Me({data:n,filters:l,type:r}){const{props:c}=ae(),{auth:u}=c,i=c.flash||{},[o,v]=t.useState({isOpen:!1,id:null,name:"",type:""}),[h,C]=t.useState({isOpen:!1,count:0,type:""}),g=`selectedItems_${r}`,[x,f,w]=ke([],g),[$,F]=t.useState(!1),[S,O]=t.useState(l?.search||""),[P,T]=t.useState(l?.per_page||10),[p,B]=t.useState({key:l?.sort||"name",direction:l?.direction||"asc"}),{success:D,error:M}=ne(),m=s=>u.user&&u.user.permissions&&u.user.permissions.includes(s),b=t.useRef({search:l?.search||"",per_page:l?.per_page||10,sort:l?.sort||"name",direction:l?.direction||"asc"});t.useEffect(()=>{const s={search:S,per_page:P,sort:p.key,direction:p.direction};if(s.search!==b.current.search||s.per_page!==b.current.per_page||s.sort!==b.current.sort||s.direction!==b.current.direction){const d=setTimeout(()=>{N.get(route("admin.role-permissions.index"),{search:S,sort:p.key,direction:p.direction,per_page:P,type:r},{preserveState:!0,replace:!0,preserveScroll:!0,onFinish:()=>{b.current=s}})},500);return()=>clearTimeout(d)}},[S,P,p,r]),t.useEffect(()=>{w(),F(!1)},[r,w]);const q=t.useCallback(()=>{if(n&&n.data){const s=n.data.map(a=>a.id);f($?a=>a.filter(d=>!s.includes(d)):a=>[...new Set([...a,...s])])}},[$,n,f]),U=t.useCallback(s=>{f(a=>a.includes(s)?a.filter(d=>d!==s):[...a,s])},[f]),z=t.useCallback((s,a,d)=>{v({isOpen:!0,id:s,name:a,type:d})},[]),W=t.useCallback(()=>{C({isOpen:!0,count:x.length,type:r})},[x.length,r]),y=t.useCallback(()=>{v({isOpen:!1,id:null,name:"",type:""})},[]),R=t.useCallback(()=>{C({isOpen:!1,count:0,type:""})},[]),X=t.useCallback(()=>{if(o.id){const s=o.type==="roles"?"admin.roles.destroy":"admin.permissions.destroy";N.delete(route(s,o.id),{onSuccess:()=>{D(`${o.type==="roles"?"Role":"Permission"} deleted successfully!`),y(),f(a=>a.filter(d=>d!==o.id))},onError:()=>{M(`Failed to delete ${o.type==="roles"?"role":"permission"}.`),y()}})}else y()},[o.id,o.type,y,D,M,f]),Y=t.useCallback(()=>{if(x.length>0){const s=r==="roles"?"admin.roles.bulk-destroy":"admin.permissions.bulk-destroy";N.post(route(s),{ids:x},{onSuccess:()=>{D(`${x.length} ${r==="roles"?"role(s)":"permission(s)"} deleted successfully!`),w(),F(!1),R()},onError:()=>{M(`Failed to delete selected ${r==="roles"?"roles":"permissions"}.`),R()}})}},[x,r,R,D,M,w]),j=t.useCallback(s=>{B(a=>{let d="asc";return a.key===s&&a.direction==="asc"&&(d="desc"),{key:s,direction:d}})},[]),Q=t.useCallback(()=>{O(""),T(10),B({key:"name",direction:"asc"}),N.get(route("admin.role-permissions.index"),{type:r,search:"",per_page:10,sort:"name",direction:"asc"},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{b.current={search:"",per_page:10,sort:"name",direction:"asc"}}})},[r]),V=t.useCallback(s=>{T(s)},[]),k=t.useCallback(s=>p.key!==s?e.jsx(J,{className:"ml-1 h-4 w-4 opacity-50"}):p.direction==="asc"?e.jsx(J,{className:"ml-1 h-4 w-4"}):e.jsx(xe,{className:"ml-1 h-4 w-4"}),[p]),G=t.useCallback(s=>{O(""),T(10),B({key:"name",direction:"asc"}),N.get(route("admin.role-permissions.index"),{type:s,search:"",per_page:10,sort:"name",direction:"asc"},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{b.current={search:"",per_page:10,sort:"name",direction:"asc"}}})},[]),Z=t.useMemo(()=>[{key:"name",label:"Role Name",sortable:!0,onSort:()=>j("name"),sortIcon:k("name"),render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center",children:e.jsx(E,{className:"h-5 w-5 text-primary-600 dark:text-primary-400"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-900 dark:text-white",children:s.name}),e.jsxs("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:[s.users_count," user(s)"]})]})]})},{key:"permissions",label:"Permissions",sortable:!1,render:s=>e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.permissions?.slice(0,3).map(a=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-accent-100 dark:bg-accent-900/30 text-accent-800 dark:text-accent-300",children:a.name},a.id)),s.permissions&&s.permissions.length>3&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-neutral-100 dark:bg-neutral-700 text-neutral-800 dark:text-neutral-300",children:["+",s.permissions.length-3," more"]})]})},{key:"created_at",label:"Created At",sortable:!0,onSort:()=>j("created_at"),sortIcon:k("created_at"),render:s=>e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:new Date(s.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"})})}],[j,k]),K=t.useMemo(()=>[{key:"name",label:"Permission Name",sortable:!0,onSort:()=>j("name"),sortIcon:k("name"),render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-accent-100 dark:bg-accent-900/30 flex items-center justify-center",children:e.jsx(L,{className:"h-5 w-5 text-accent-600 dark:text-accent-400"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-neutral-900 dark:text-white",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:s.description})]})]})},{key:"roles",label:"Assigned Roles",sortable:!1,render:s=>e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.roles?.slice(0,3).map(a=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-success-100 dark:bg-success-900/30 text-success-800 dark:text-success-300",children:a.name},a.id)),s.roles&&s.roles.length>3&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-neutral-100 dark:bg-neutral-700 text-neutral-800 dark:text-neutral-300",children:["+",s.roles.length-3," more"]})]})},{key:"created_at",label:"Created At",sortable:!0,onSort:()=>j("created_at"),sortIcon:k("created_at"),render:s=>e.jsx("div",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:new Date(s.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"})})}],[j,k]),ee=r==="roles"?Z:K,se=t.useMemo(()=>e.jsx("div",{className:"flex flex-col items-center justify-center text-neutral-400 dark:text-neutral-500",children:r==="roles"?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-12 w-12 mb-3 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No roles found"}),e.jsx("p",{className:"mt-1 text-sm",children:"Get started by creating a new role"}),m("create roles")&&e.jsx("div",{className:"mt-6",children:e.jsx(I,{href:route("admin.roles.create"),children:e.jsxs(_,{className:"flex items-center bg-primary-600 hover:bg-primary-700 focus:ring-primary-500",children:[e.jsx(A,{className:"mr-2 h-5 w-5"}),"Add New Role"]})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-12 w-12 mb-3 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No permissions found"}),e.jsx("p",{className:"mt-1 text-sm",children:"Get started by creating a new permission"}),m("create permissions")&&e.jsx("div",{className:"mt-6",children:e.jsx(I,{href:route("admin.permissions.create"),children:e.jsxs(_,{className:"flex items-center bg-accent-600 hover:bg-accent-700 focus:ring-accent-500",children:[e.jsx(A,{className:"mr-2 h-5 w-5"}),"Add New Permission"]})})})]})}),[r]),re=t.useCallback(s=>e.jsx(je,{item:s,type:r,onEdit:()=>N.visit(route(r==="roles"?"admin.roles.edit":"admin.permissions.edit",s.id)),onDelete:()=>z(s.id,s.name,r),hasEditPermission:m(r==="roles"?"edit roles":"edit permissions"),hasDeletePermission:m(r==="roles"?"delete roles":"delete permissions")}),[r,z]),te=t.useMemo(()=>r==="roles"&&m("create roles")?e.jsx(I,{href:route("admin.roles.create"),children:e.jsxs(_,{className:"flex items-center bg-primary-600 hover:bg-primary-700 focus:ring-primary-500",children:[e.jsx(A,{className:"mr-2 h-5 w-5"}),"Add Role"]})}):r==="permissions"&&m("create permissions")?e.jsx(I,{href:route("admin.permissions.create"),children:e.jsxs(_,{className:"flex items-center bg-accent-600 hover:bg-accent-700 focus:ring-accent-500",children:[e.jsx(A,{className:"mr-2 h-5 w-5"}),"Add Permission"]})}):null,[r]);return e.jsxs(oe,{title:r==="roles"?"Manage Roles":"Manage Permissions",children:[e.jsx(le,{title:r==="roles"?"Manage Roles":"Manage Permissions"}),m(r==="roles"?"delete roles":"delete permissions")&&e.jsx(H,{isOpen:o.isOpen,onClose:y,onConfirm:X,title:`Confirm Delete ${o.type==="roles"?"Role":"Permission"}`,message:`Are you sure you want to delete ${o.type==="roles"?"role":"permission"} "${o.name}"? This action cannot be undone.`,confirmText:`Delete ${o.type==="roles"?"Role":"Permission"}`,cancelText:"Cancel"}),m(r==="roles"?"delete roles":"delete permissions")&&e.jsx(H,{isOpen:h.isOpen,onClose:R,onConfirm:Y,title:`Confirm Bulk Delete ${h.type==="roles"?"Roles":"Permissions"}`,message:`Are you sure you want to delete ${h.count} selected ${h.type==="roles"?"role(s)":"permission(s)"}? This action cannot be undone.`,confirmText:`Delete ${h.count} ${h.type==="roles"?"Roles":"Permissions"}`,cancelText:"Cancel"}),e.jsxs(ie,{title:r==="roles"?"Role Management":"Permission Management",description:r==="roles"?"Manage user roles and their permissions":"Manage system permissions and assign them to roles",createButton:te,filters:e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:e.jsxs("div",{className:"flex space-x-1",children:[m("view roles")&&e.jsxs("button",{onClick:()=>G("roles"),className:`px-4 py-2 rounded-xl text-sm font-medium ${r==="roles"?"bg-primary-600 text-white":"bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-300 dark:hover:bg-neutral-600"}`,children:[e.jsx(E,{className:"inline mr-2 h-4 w-4"}),"Roles"]}),m("view permissions")&&e.jsxs("button",{onClick:()=>G("permissions"),className:`px-4 py-2 rounded-xl text-sm font-medium ${r==="permissions"?"bg-accent-600 text-white":"bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-300 dark:hover:bg-neutral-600"}`,children:[e.jsx(L,{className:"inline mr-2 h-4 w-4"}),"Permissions"]})]})}),e.jsx(ue,{searchTerm:S,onSearchChange:O,perPage:P,onPerPageChange:V,onClearFilters:Q})]}),children:[i.success&&e.jsx("div",{className:"mb-8 bg-success-50 dark:bg-success-900/30 border border-success-200 dark:border-success-800 rounded-xl p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-success-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-success-800 dark:text-success-200",children:i.success})})]})}),i.error&&e.jsx("div",{className:"mb-8 bg-error-50 dark:bg-error-900/30 border border-error-200 dark:border-error-800 rounded-xl p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-error-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-error-800 dark:text-error-200",children:i.error})})]})}),m(r==="roles"?"delete roles":"delete permissions")&&x.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(ce,{selectedCount:x.length,onBulkDelete:W,onClearSelected:()=>{w(),F(!1)}})}),e.jsx("div",{className:"mb-6",children:e.jsx(de,{columns:ee,data:n?.data||[],selectedItems:x,onSelectItem:U,onSelectAll:q,selectAll:$,emptyState:se,rowActions:re,keyField:"id"},r)}),n&&n.data&&n.data.length>0&&n.links&&n.links.length>3&&e.jsx(me,{data:n,filters:{type:r}})]})]})}export{Me as default};
